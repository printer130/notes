---
title: 'Malware'
description: ''
pubDate: 'May 12 2023'
heroImage: '/malware.png'
slug: 'cppt/malware'
---

## Virus

Es un programa que se copia a si mismo y se esparce sin el consentimiento del usuario.

Por ejemplo supongamos que un archivo esta infectado si el usuario mueve el archivo a otro sistema el virus tiene chances the sobrevivir y propagarse.

**Resident:** Cuando se ejecuta se convierte en residente en memoria y espera hasta que una accion tome efecto por ejemplo la carga de otro programa.

**Non-resident:** Cuando es ejecutado va a buscar archivos a infectar, luego de infectarlos, va a salir, cuando el programa es ejecutado de nuevo va a buscar nuevos objetivos.

**Boot-sector virus:** Se esparce por los sectores boot. S un usuario deja un CD-ROM infectado mientras el sistema esta apagado, la siguiente vez que prendan el sistema el virus se activa y se esparce por el disco duro que luego se esparce por otros discos, cuando Discos/Pen Drives son movidos, el ciclo se repite.

**Multi-partite:** Tienen muchos mecanismos de infeccion, puede ser por ejemplo que sean 'Boot-sector' o 'Resident' o incluso mas.

## Trojan Horse

**Troyano** es un tipo de malware que al usuario le parece que realiza una función pero en realidad facilita el acceso sin autorización al owner's system.

Por otra parte, son diferentes de los virus no son autoreplicantes a diferencia de los virus.

Alguien te manda un salva-pantallas y podria ser un troyano.

## Rootkit

Esta diseñado para ocultarse y son instalados como drivers.

- Application level
- Library level
- kernel level
- Hypervisor level
- Firmware level

Es usado como un suplemento para otros malwares.

Es usado para ocultar procesos, archivos en el sistema, o implementar backdoors o crear loopholes.

**Application level:** Remplaza programas por copias de otros programas.

**Library level:** Diremos que 10 aplicaciónes estan compartiendo una libreria, tomar el control de la libreria supone tomar el control de las 10 aplicaciónes.

**Kernel level:** Son conocidos como su resistencia a la eliminación desde que se ejecuta al mismo nivel que de los privilegios del antivirus.

**Hypervisor level:** Se aprovecha de los procesos de virtualizacion para hacer sus matufias. ej. blue-pill y subvirt.

**Firmware level:** No existen herramientas para verificarlos porque corren en la BIOS, tablas ACPI.

## Bootkit

**Bootkits** agarran el OS durante el proceso de boot, y empiezan atacar el OS cuando no inicializo siquiera difieren de los rootkitse en el proceso de instalacion y como y cuando se apoderan del OS.

## Greyware

Puede ser un spyware o adware.

## Dialer

En vez de conectar a numeros normales al internet se conecta a numeros premium que tienen cargo alto, the dueño del dialer quien a configurado la cuestión hace grandes sumas de dinero.

## Ransomware

Extorsion va muy bien con ellos para restaurar el OS comprometido

# Techniques

## Streams

The data stream is file data itself, all other streams have a name. Alternate data streams can be used to store file meta data/or any other data.

```bash
echo "data hidden in the stream" >> prueba.txt:hstream
```

**Stream**

**Hooking native APIs / SSDT**

**Hooking IRP**

**Hiden a Process**

**API Hooking**

**Anti-Debugging Methods**

**Anti-virtual Machine**

- It is in low memory less than 0xd0 while for virtualized OS (VMware/Virtual Pc), it is higher than that.

<img src="https://res.cloudinary.com/djc1umong/image/upload/v1686940853/virtual_malware_hnprua.jpg" alt=''>

**Obfuscation**

- Obfuscation makes programs more difficult to reverse engineer.

**Packers**

- Packers allow to compress/encrypt applications.

- You cannot see the code of the application using a disassembler, you need to unpack it first.

- Packers compress applications and add a small loader to the file.

- The loader will decompress the binary in memory, resolve imports, and call the Original Entry Point(OEP)

**Polymorphism**

- All polymorphic viruses have a constant encoding and variable decryptor. So a virus using a different XOR key to encrypt its variant also falls into polymorphic category.

- Polymorphic code aims at performing a given action (or algorithm) through code that mutates and changes every time the action has to be taken.

**Metamorphism**

- Polymorphism/Metamorphism (both are similar with some minor differences), applied to the decryptor/header as well.
